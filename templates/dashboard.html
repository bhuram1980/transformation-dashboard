<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformation Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script>
        // All features enabled - no authentication
        window.userRole = 'viewer';
        window.isAdmin = true;
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <h1>üî• Transformation Dashboard</h1>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="streak-badge" id="streakBadge">
                        <span id="streakCount">0</span> Day Streak
                        <div class="streak-glow" id="streakGlow"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Goal Section -->
        <section class="goal-section">
            <h2>üéØ Goal</h2>
            <p id="goalText">Loading...</p>
        </section>

        <!-- Key Metrics Cards -->
        <section class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Android Fat %</div>
                <div class="metric-value" id="androidFat">-</div>
                <div class="metric-target">Target: ‚â§15%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="androidFatProgress"></div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Body Fat %</div>
                <div class="metric-value" id="bodyFat">-</div>
                <div class="metric-target">Target: ‚â§13%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="bodyFatProgress"></div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-label">ALT</div>
                <div class="metric-value" id="alt">-</div>
                <div class="metric-target">Target: <80</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="altProgress"></div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Glucose</div>
                <div class="metric-value" id="glucose">-</div>
                <div class="metric-target">Target: <95</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="glucoseProgress"></div>
                </div>
            </div>
        </section>

        <!-- Grok Chat Section -->
        <section class="chat-section" style="margin-bottom: 30px;">
            <div class="section-header">
                <h2>üí¨ Chat with Grok AI</h2>
                <span style="font-size: 0.9em; color: #666;">Ask me to log entries, upload photos, or get advice!</span>
            </div>
            <div class="chat-container" id="chatContainer">
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message bot-message">
                        <div class="message-content">
                            üëã Hi! I'm Grok, your transformation assistant. I can help you:
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>üìù Add or update daily log entries</li>
                                <li>üì∏ Upload progress photos</li>
                                <li>üìä View your current stats</li>
                                <li>üí° Provide personalized advice</li>
                            </ul>
                            Try: "Add Day 4: 395g protein, 42g carbs, 1.2kg seafood, 2hr surfing"
                        </div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input 
                        type="text" 
                        id="chatInput" 
                        class="chat-input" 
                        placeholder="Type your message..."
                        onkeypress="if(event.key === 'Enter') sendChatMessage()"
                    >
                    <button class="chat-send-btn" onclick="sendChatMessage()">Send</button>
                </div>
            </div>
        </section>

        <!-- Grok Advice Section -->
        <section class="advice-section">
            <div class="section-header">
                <h2>ü§ñ Daily Grok Advice</h2>
                <button class="btn-refresh" onclick="loadAdvice()">üîÑ Refresh</button>
            </div>
            <div class="advice-box" id="adviceBox">
                <div class="loading">Loading advice from Grok...</div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <div class="chart-container">
                <h3>Daily Macros (Last 7 Days)</h3>
                <canvas id="macrosChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Protein Intake Trend</h3>
                <canvas id="proteinChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Seafood Intake (kg)</h3>
                <canvas id="seafoodChart"></canvas>
            </div>
        </section>

        <!-- Recent Days Table -->
        <section class="recent-days-section">
            <h2>üìä Recent Days</h2>
            <div class="table-container">
                <table id="recentDaysTable">
                    <thead>
                        <tr>
                            <th>Day</th>
                            <th>Date</th>
                            <th>Protein (g)</th>
                            <th>Carbs (g)</th>
                            <th>Fat (g)</th>
                            <th>Kcal</th>
                            <th>Seafood (kg)</th>
                            <th>Training</th>
                            <th>Feeling</th>
                        </tr>
                    </thead>
                    <tbody id="recentDaysBody">
                        <tr><td colspan="9">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Progress Charts Section -->
        <section class="progress-charts-section">
            <h2>üìâ Progress Over Time</h2>
            <div class="charts-grid">
                <div class="chart-container">
                    <h3>Weight Trend (kg)</h3>
                    <canvas id="weightChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Waist Measurement (cm)</h3>
                    <canvas id="waistChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Macro Calculator Section -->
        <section class="calculator-section">
            <h2>üßÆ Macro Calculator</h2>
            <div class="calculator-box">
                <div class="calc-input-group">
                    <label>Seafood (kg):</label>
                    <input type="number" id="fishKg" step="0.1" min="0" placeholder="1.2" oninput="calculateMacros()">
                </div>
                <div class="calc-input-group">
                    <label>Fish Type:</label>
                    <select id="fishType" onchange="calculateMacros()">
                        <option value="salmon">Salmon</option>
                        <option value="tuna">Tuna</option>
                        <option value="seabass">Seabass</option>
                        <option value="lobster">Lobster</option>
                        <option value="mixed">Mixed</option>
                    </select>
                </div>
                <div class="calc-results">
                    <div class="calc-result-item">
                        <span class="calc-label">Estimated Protein:</span>
                        <span class="calc-value" id="calcProtein">0 g</span>
                    </div>
                    <div class="calc-result-item">
                        <span class="calc-label">Estimated Fat:</span>
                        <span class="calc-value" id="calcFat">0 g</span>
                    </div>
                    <div class="calc-result-item">
                        <span class="calc-label">Estimated Calories:</span>
                        <span class="calc-value" id="calcKcal">0 kcal</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Photo Upload Section -->
        <section class="photo-section">
            <h2>üì∏ Progress Photos</h2>
            <div class="photo-upload-box">
                <input type="file" id="photoInput" accept="image/*" capture="environment" style="display: none;" onchange="handlePhotoUpload(event)">
                <button class="btn-upload" onclick="document.getElementById('photoInput').click()">
                    üì∑ Upload Photo (Fish Plate / Mirror Selfie)
                </button>
                <div id="photoPreview" class="photo-preview"></div>
                <div style="margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; color: #667eea; font-size: 1.2em;">üì∑ Photo Gallery</h3>
                        <button onclick="loadPhotos()" style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.9em;">üîÑ Refresh</button>
                    </div>
                    <div id="photoGallery" class="photo-gallery"></div>
                </div>
            </div>
        </section>

        <!-- Stats Summary -->
        <section class="stats-section">
            <h2>üìà 7-Day Averages</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">Avg Protein</span>
                    <span class="stat-value" id="avgProtein">-</span>
                    <span class="stat-target">Target: 350-420g</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Avg Carbs</span>
                    <span class="stat-value" id="avgCarbs">-</span>
                    <span class="stat-target">Target: <50g</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Avg Fat</span>
                    <span class="stat-value" id="avgFat">-</span>
                    <span class="stat-target">Target: 150-200g</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Avg Seafood</span>
                    <span class="stat-value" id="avgSeafood">-</span>
                    <span class="stat-target">Target: 1.0-1.5kg</span>
                </div>
            </div>
        </section>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>

